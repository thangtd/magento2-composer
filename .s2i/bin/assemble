#!/bin/bash -e
# The assemble script builds the application artifacts from a source and 
# places them into appropriate directories inside the image.

mkdir -p /tmp/preassemble

# Execute the default S2I script
source ${STI_SCRIPTS_PATH}/assemble

mkdir -p /tmp/postassemble

find ./var ./vendor ./pub/static ./pub/media ./app/etc -type f -exec chmod g+w {} \; && find ./var ./vendor ./pub/static ./pub/media ./app/etc -type d -exec chmod 775 {} \; && chmod u+x ./bin/magento

php bin/magento setup:install --db-host=${DATABASE_SERVICE_NAME} --db-name=${DATABASE_NAME} --db-user=${DATABASE_USER} --db-password=${DATABASE_PASSWORD} --backend-frontname=admin --admin-user=infinity2067 --admin-password=84730*estinkill --admin-email=thangtd@gmail.com --admin-firstname=Henry --admin-lastname=Tran --base-url=http://m2-mysql-persistent-m2.192.168.1.8.nip.io/ --base-url-secure=https://m2-mysql-persistent-m2.192.168.1.8.nip.io/ --language=en_US --currency=USD --use-rewrites=1 --use-secure=0 --use-secure-admin=0 --cleanup-database

# You can write S2I scripts in any programming language, as long as the 
# scripts are executable inside the builder image.